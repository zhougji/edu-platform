"use strict";(self["webpackChunkqimingyu_student_app"]=self["webpackChunkqimingyu_student_app"]||[]).push([[475],{6475:function(e,r,a){a.r(r),a.d(r,{default:function(){return p}});var s=function(){var e=this,r=e._self._c;return r("div",{staticClass:"profile-page"},[r("el-card",[r("div",{attrs:{slot:"header"},slot:"header"},[r("span",[e._v("个人资料")])]),r("el-tabs",{model:{value:e.activeTab,callback:function(r){e.activeTab=r},expression:"activeTab"}},[r("el-tab-pane",{attrs:{label:"基本信息",name:"basic"}},[r("el-row",{staticStyle:{"margin-top":"20px"},attrs:{gutter:40}},[r("el-col",{staticStyle:{"text-align":"center"},attrs:{span:6}},[r("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/api/students/upload-avatar",headers:e.uploadHeaders,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload,"on-error":e.handleAvatarError}},[r("el-avatar",{staticClass:"profile-avatar",attrs:{size:120,src:e.profileForm.avatar||e.defaultAvatar}}),r("div",{staticClass:"upload-overlay"},[e._v("点击上传头像")])],1),r("p",{staticStyle:{color:"#909399","font-size":"0.85em","margin-top":"10px"}},[e._v("支持 JPG/PNG 格式, 小于 2MB")])],1),r("el-col",{attrs:{span:18}},[r("el-form",{ref:"profileForm",attrs:{model:e.profileForm,rules:e.profileRules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"姓名",prop:"name"}},[r("el-input",{attrs:{placeholder:"请输入姓名"},model:{value:e.profileForm.name,callback:function(r){e.$set(e.profileForm,"name",r)},expression:"profileForm.name"}})],1),r("el-form-item",{attrs:{label:"邮箱"}},[r("el-input",{attrs:{value:e.profileForm.email,disabled:""}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary",loading:e.isSavingProfile},on:{click:e.updateProfile}},[e._v("保存基本信息")])],1)],1)],1)],1)],1),r("el-tab-pane",{attrs:{label:"修改密码",name:"password"}},[r("el-form",{ref:"passwordForm",staticStyle:{"margin-top":"20px","max-width":"500px"},attrs:{model:e.passwordForm,rules:e.passwordRules,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"当前密码",prop:"currentPassword"}},[r("el-input",{attrs:{type:"password",placeholder:"请输入当前密码","show-password":""},model:{value:e.passwordForm.currentPassword,callback:function(r){e.$set(e.passwordForm,"currentPassword",r)},expression:"passwordForm.currentPassword"}})],1),r("el-form-item",{attrs:{label:"新密码",prop:"newPassword"}},[r("el-input",{attrs:{type:"password",placeholder:"请输入新密码 (至少6位)","show-password":""},model:{value:e.passwordForm.newPassword,callback:function(r){e.$set(e.passwordForm,"newPassword",r)},expression:"passwordForm.newPassword"}})],1),r("el-form-item",{attrs:{label:"确认新密码",prop:"confirmPassword"}},[r("el-input",{attrs:{type:"password",placeholder:"请再次输入新密码","show-password":""},model:{value:e.passwordForm.confirmPassword,callback:function(r){e.$set(e.passwordForm,"confirmPassword",r)},expression:"passwordForm.confirmPassword"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary",loading:e.isSavingPassword},on:{click:e.changePassword}},[e._v("确认修改密码")])],1)],1)],1)],1)],1)],1)},t=[],o=(a(4114),a(5353)),i={name:"UserProfile",data(){const e=(e,r,a)=>{""===r?a(new Error("请再次输入新密码")):r!==this.passwordForm.newPassword?a(new Error("两次输入的新密码不一致!")):a()};return{activeTab:"basic",isSavingProfile:!1,isSavingPassword:!1,profileForm:{name:"",email:"",avatar:""},passwordForm:{currentPassword:"",newPassword:"",confirmPassword:""},profileRules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}]},passwordRules:{currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度至少为6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:e,trigger:"blur"}]},defaultAvatar:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",uploadHeaders:{Authorization:`Bearer ${localStorage.getItem("studentToken")}`}}},computed:{...(0,o.L8)(["studentInfo"])},methods:{...(0,o.i0)(["updateStudentInfo","showSnackbar","logout"]),updateProfile(){this.$refs.profileForm.validate((e=>{if(e){this.isSavingProfile=!0;const e={name:this.profileForm.name};this.$axios.put("/students/profile",e).then((r=>{this.updateStudentInfo(r.data||e),this.showSnackbar({text:"基本信息更新成功!",color:"success"})})).catch((e=>{console.error("Profile update failed:",e.response?.data||e.message);const r=e.response?.data?.message||"信息更新失败";this.showSnackbar({text:r,color:"error"})})).finally((()=>{this.isSavingProfile=!1}))}}))},handleAvatarSuccess(e,r){const a=e.url||URL.createObjectURL(r.raw);this.profileForm.avatar=a,this.updateStudentInfo({avatar:a}),this.showSnackbar({text:"头像上传成功!",color:"success"})},beforeAvatarUpload(e){const r="image/jpeg"===e.type,a="image/png"===e.type,s=e.size/1024/1024<2;return r||a||this.$message.error("上传头像图片只能是 JPG 或 PNG 格式!"),s||this.$message.error("上传头像图片大小不能超过 2MB!"),(r||a)&&s},handleAvatarError(e){console.error("Avatar upload failed:",e),this.showSnackbar({text:"头像上传失败，请重试",color:"error"})},changePassword(){this.$refs.passwordForm.validate((e=>{if(e){this.isSavingPassword=!0;const e={currentPassword:this.passwordForm.currentPassword,newPassword:this.passwordForm.newPassword};this.$axios.put("/students/password",e).then((()=>{this.showSnackbar({text:"密码修改成功！请重新登录。",color:"success"}),this.$refs.passwordForm.resetFields(),setTimeout((()=>{this.logout(),this.$router.push("/login").catch((()=>{}))}),1500)})).catch((e=>{console.error("Password change failed:",e.response?.data||e.message);const r=e.response?.data?.message||"密码修改失败，请检查当前密码是否正确";this.showSnackbar({text:r,color:"error"})})).finally((()=>{this.isSavingPassword=!1}))}}))},setInitialData(){this.studentInfo&&(this.profileForm.name=this.studentInfo.name||"",this.profileForm.email=this.studentInfo.email||"",this.profileForm.avatar=this.studentInfo.avatar||"")}},created(){this.setInitialData()},watch:{studentInfo(e){e&&this.setInitialData()}}},l=i,n=a(1656),d=(0,n.A)(l,s,t,!1,null,"51ba623e",null),p=d.exports}}]);
//# sourceMappingURL=475.83bc1f26.js.map