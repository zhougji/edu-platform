{"ast":null,"code":"import { createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, withCtx as _withCtx, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, normalizeClass as _normalizeClass } from \"vue\";\nconst _hoisted_1 = {\n  class: \"page-container\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"consultation-history\"\n};\nconst _hoisted_3 = {\n  key: 1,\n  class: \"empty-state\"\n};\nconst _hoisted_4 = {\n  key: 0\n};\nconst _hoisted_5 = {\n  key: 0,\n  class: \"chat-section\"\n};\nconst _hoisted_6 = {\n  class: \"chat-messages\"\n};\nconst _hoisted_7 = {\n  class: \"message-sender\"\n};\nconst _hoisted_8 = {\n  class: \"message-content\"\n};\nconst _hoisted_9 = {\n  class: \"message-time\"\n};\nconst _hoisted_10 = {\n  class: \"chat-input\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_table_column = _resolveComponent(\"el-table-column\");\n  const _component_el_tag = _resolveComponent(\"el-tag\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_table = _resolveComponent(\"el-table\");\n  const _component_el_empty = _resolveComponent(\"el-empty\");\n  const _component_el_divider = _resolveComponent(\"el-divider\");\n  const _component_el_option = _resolveComponent(\"el-option\");\n  const _component_el_select = _resolveComponent(\"el-select\");\n  const _component_el_form_item = _resolveComponent(\"el-form-item\");\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_radio = _resolveComponent(\"el-radio\");\n  const _component_el_radio_group = _resolveComponent(\"el-radio-group\");\n  const _component_el_form = _resolveComponent(\"el-form\");\n  const _component_el_descriptions_item = _resolveComponent(\"el-descriptions-item\");\n  const _component_el_descriptions = _resolveComponent(\"el-descriptions\");\n  const _component_el_dialog = _resolveComponent(\"el-dialog\");\n  const _component_el_card = _resolveComponent(\"el-card\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_el_card, {\n    class: \"page-card\"\n  }, {\n    default: _withCtx(() => [_cache[13] || (_cache[13] = _createElementVNode(\"h2\", null, \"在线咨询\", -1 /* HOISTED */)), $data.consultations.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [_cache[6] || (_cache[6] = _createElementVNode(\"h3\", null, \"咨询历史\", -1 /* HOISTED */)), _createVNode(_component_el_table, {\n      data: $data.consultations,\n      stripe: \"\",\n      style: {\n        \"width\": \"100%\"\n      }\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_table_column, {\n        prop: \"subject\",\n        label: \"咨询主题\",\n        width: \"180\"\n      }), _createVNode(_component_el_table_column, {\n        prop: \"date\",\n        label: \"提交日期\",\n        width: \"180\"\n      }), _createVNode(_component_el_table_column, {\n        prop: \"status\",\n        label: \"状态\"\n      }, {\n        default: _withCtx(scope => [_createVNode(_component_el_tag, {\n          type: $options.getStatusType(scope.row.status)\n        }, {\n          default: _withCtx(() => [_createTextVNode(_toDisplayString(scope.row.status), 1 /* TEXT */)]),\n          _: 2 /* DYNAMIC */\n        }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"type\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_table_column, {\n        label: \"操作\"\n      }, {\n        default: _withCtx(scope => [_createVNode(_component_el_button, {\n          size: \"small\",\n          type: \"primary\",\n          onClick: $event => $options.viewConsultation(scope.row),\n          disabled: scope.row.status === '等待中'\n        }, {\n          default: _withCtx(() => _cache[5] || (_cache[5] = [_createTextVNode(\"查看详情\")])),\n          _: 2 /* DYNAMIC */\n        }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\", \"disabled\"])]),\n        _: 1 /* STABLE */\n      })]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"data\"])])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_createVNode(_component_el_empty, {\n      description: \"暂无咨询记录\"\n    })])), _createVNode(_component_el_divider), _cache[14] || (_cache[14] = _createElementVNode(\"h3\", null, \"发起新咨询\", -1 /* HOISTED */)), _createVNode(_component_el_form, {\n      model: $data.consultForm,\n      rules: $data.rules,\n      ref: \"consultForm\",\n      \"label-width\": \"100px\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_form_item, {\n        label: \"学科\",\n        prop: \"subject\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_select, {\n          modelValue: $data.consultForm.subject,\n          \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.consultForm.subject = $event),\n          placeholder: \"请选择学科\"\n        }, {\n          default: _withCtx(() => [_createVNode(_component_el_option, {\n            label: \"数学\",\n            value: \"math\"\n          }), _createVNode(_component_el_option, {\n            label: \"语文\",\n            value: \"chinese\"\n          }), _createVNode(_component_el_option, {\n            label: \"英语\",\n            value: \"english\"\n          }), _createVNode(_component_el_option, {\n            label: \"物理\",\n            value: \"physics\"\n          }), _createVNode(_component_el_option, {\n            label: \"化学\",\n            value: \"chemistry\"\n          }), _createVNode(_component_el_option, {\n            label: \"生物\",\n            value: \"biology\"\n          }), _createVNode(_component_el_option, {\n            label: \"历史\",\n            value: \"history\"\n          }), _createVNode(_component_el_option, {\n            label: \"地理\",\n            value: \"geography\"\n          }), _createVNode(_component_el_option, {\n            label: \"政治\",\n            value: \"politics\"\n          }), _createVNode(_component_el_option, {\n            label: \"其他\",\n            value: \"other\"\n          })]),\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"modelValue\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_form_item, {\n        label: \"咨询问题\",\n        prop: \"question\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_input, {\n          type: \"textarea\",\n          modelValue: $data.consultForm.question,\n          \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $data.consultForm.question = $event),\n          rows: \"4\",\n          placeholder: \"请详细描述您的问题...\"\n        }, null, 8 /* PROPS */, [\"modelValue\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_form_item, {\n        label: \"紧急程度\",\n        prop: \"urgency\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_radio_group, {\n          modelValue: $data.consultForm.urgency,\n          \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $data.consultForm.urgency = $event)\n        }, {\n          default: _withCtx(() => [_createVNode(_component_el_radio, {\n            label: \"low\"\n          }, {\n            default: _withCtx(() => _cache[7] || (_cache[7] = [_createTextVNode(\"普通\")])),\n            _: 1 /* STABLE */\n          }), _createVNode(_component_el_radio, {\n            label: \"medium\"\n          }, {\n            default: _withCtx(() => _cache[8] || (_cache[8] = [_createTextVNode(\"较急\")])),\n            _: 1 /* STABLE */\n          }), _createVNode(_component_el_radio, {\n            label: \"high\"\n          }, {\n            default: _withCtx(() => _cache[9] || (_cache[9] = [_createTextVNode(\"紧急\")])),\n            _: 1 /* STABLE */\n          })]),\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"modelValue\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_form_item, null, {\n        default: _withCtx(() => [_createVNode(_component_el_button, {\n          type: \"primary\",\n          onClick: $options.submitConsult,\n          loading: $data.submitting\n        }, {\n          default: _withCtx(() => _cache[10] || (_cache[10] = [_createTextVNode(\"提交咨询\")])),\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"onClick\", \"loading\"])]),\n        _: 1 /* STABLE */\n      })]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"model\", \"rules\"]), _createCommentVNode(\" 咨询详情对话框 \"), _createVNode(_component_el_dialog, {\n      modelValue: $data.dialogVisible,\n      \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => $data.dialogVisible = $event),\n      title: \"咨询详情\",\n      width: \"60%\"\n    }, {\n      default: _withCtx(() => [$data.currentConsultation ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [_createElementVNode(\"h3\", null, _toDisplayString($data.currentConsultation.subject) + \" 咨询\", 1 /* TEXT */), _createVNode(_component_el_descriptions, {\n        column: 1,\n        border: \"\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_descriptions_item, {\n          label: \"咨询问题\"\n        }, {\n          default: _withCtx(() => [_createTextVNode(_toDisplayString($data.currentConsultation.question), 1 /* TEXT */)]),\n          _: 1 /* STABLE */\n        }), _createVNode(_component_el_descriptions_item, {\n          label: \"提交时间\"\n        }, {\n          default: _withCtx(() => [_createTextVNode(_toDisplayString($data.currentConsultation.date), 1 /* TEXT */)]),\n          _: 1 /* STABLE */\n        }), _createVNode(_component_el_descriptions_item, {\n          label: \"回复老师\"\n        }, {\n          default: _withCtx(() => [_createTextVNode(_toDisplayString($data.currentConsultation.teacherName || '未分配'), 1 /* TEXT */)]),\n          _: 1 /* STABLE */\n        }), _createVNode(_component_el_descriptions_item, {\n          label: \"回复内容\"\n        }, {\n          default: _withCtx(() => [_createTextVNode(_toDisplayString($data.currentConsultation.answer || '等待老师回复...'), 1 /* TEXT */)]),\n          _: 1 /* STABLE */\n        })]),\n        _: 1 /* STABLE */\n      }), $data.currentConsultation.status === '已接受' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_cache[12] || (_cache[12] = _createElementVNode(\"h4\", null, \"追加咨询\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_6, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.currentConsultation.messages, (msg, idx) => {\n        return _openBlock(), _createElementBlock(\"div\", {\n          key: idx,\n          class: _normalizeClass(['message', msg.sender === 'student' ? 'message-student' : 'message-teacher'])\n        }, [_createElementVNode(\"div\", _hoisted_7, _toDisplayString(msg.sender === 'student' ? '我' : $data.currentConsultation.teacherName), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_8, _toDisplayString(msg.content), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_9, _toDisplayString(msg.time), 1 /* TEXT */)], 2 /* CLASS */);\n      }), 128 /* KEYED_FRAGMENT */))]), _createElementVNode(\"div\", _hoisted_10, [_createVNode(_component_el_input, {\n        modelValue: $data.messageInput,\n        \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $data.messageInput = $event),\n        placeholder: \"输入追加问题...\",\n        rows: \"2\",\n        type: \"textarea\"\n      }, null, 8 /* PROPS */, [\"modelValue\"]), _createVNode(_component_el_button, {\n        type: \"primary\",\n        onClick: $options.sendMessage,\n        disabled: !$data.messageInput.trim()\n      }, {\n        default: _withCtx(() => _cache[11] || (_cache[11] = [_createTextVNode(\"发送\")])),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"onClick\", \"disabled\"])])])) : _createCommentVNode(\"v-if\", true)])) : _createCommentVNode(\"v-if\", true)]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"modelValue\"])]),\n    _: 1 /* STABLE */\n  })]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","_hoisted_1","_createVNode","_component_el_card","default","_withCtx","_createElementVNode","$data","consultations","length","_hoisted_2","_component_el_table","data","stripe","style","_component_el_table_column","prop","label","width","scope","_component_el_tag","type","$options","getStatusType","row","status","_createTextVNode","_toDisplayString","_","_component_el_button","size","onClick","$event","viewConsultation","disabled","_cache","_hoisted_3","_component_el_empty","description","_component_el_divider","_component_el_form","model","consultForm","rules","ref","_component_el_form_item","_component_el_select","modelValue","subject","placeholder","_component_el_option","value","_component_el_input","question","rows","_component_el_radio_group","urgency","_component_el_radio","submitConsult","loading","submitting","_createCommentVNode","_component_el_dialog","dialogVisible","title","currentConsultation","_hoisted_4","_component_el_descriptions","column","border","_component_el_descriptions_item","date","teacherName","answer","_hoisted_5","_hoisted_6","_Fragment","_renderList","messages","msg","idx","_normalizeClass","sender","_hoisted_7","_hoisted_8","content","_hoisted_9","time","_hoisted_10","messageInput","sendMessage","trim"],"sources":["D:\\Code\\coding\\edu-platform\\student-app\\src\\components\\OnlineConsult.vue"],"sourcesContent":["<template>\r\n  <div class=\"page-container\">\r\n    <el-card class=\"page-card\">\r\n      <h2>在线咨询</h2>\r\n      \r\n      <div v-if=\"consultations.length > 0\" class=\"consultation-history\">\r\n        <h3>咨询历史</h3>\r\n        <el-table :data=\"consultations\" stripe style=\"width: 100%\">\r\n          <el-table-column prop=\"subject\" label=\"咨询主题\" width=\"180\"></el-table-column>\r\n          <el-table-column prop=\"date\" label=\"提交日期\" width=\"180\"></el-table-column>\r\n          <el-table-column prop=\"status\" label=\"状态\">\r\n            <template #default=\"scope\">\r\n              <el-tag :type=\"getStatusType(scope.row.status)\">{{ scope.row.status }}</el-tag>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"操作\">\r\n            <template #default=\"scope\">\r\n              <el-button \r\n                size=\"small\" \r\n                type=\"primary\" \r\n                @click=\"viewConsultation(scope.row)\"\r\n                :disabled=\"scope.row.status === '等待中'\"\r\n              >查看详情</el-button>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n      </div>\r\n      \r\n      <div v-else class=\"empty-state\">\r\n        <el-empty description=\"暂无咨询记录\"></el-empty>\r\n      </div>\r\n      \r\n      <el-divider></el-divider>\r\n      \r\n      <h3>发起新咨询</h3>\r\n      <el-form :model=\"consultForm\" :rules=\"rules\" ref=\"consultForm\" label-width=\"100px\">\r\n        <el-form-item label=\"学科\" prop=\"subject\">\r\n          <el-select v-model=\"consultForm.subject\" placeholder=\"请选择学科\">\r\n            <el-option label=\"数学\" value=\"math\"></el-option>\r\n            <el-option label=\"语文\" value=\"chinese\"></el-option>\r\n            <el-option label=\"英语\" value=\"english\"></el-option>\r\n            <el-option label=\"物理\" value=\"physics\"></el-option>\r\n            <el-option label=\"化学\" value=\"chemistry\"></el-option>\r\n            <el-option label=\"生物\" value=\"biology\"></el-option>\r\n            <el-option label=\"历史\" value=\"history\"></el-option>\r\n            <el-option label=\"地理\" value=\"geography\"></el-option>\r\n            <el-option label=\"政治\" value=\"politics\"></el-option>\r\n            <el-option label=\"其他\" value=\"other\"></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        \r\n        <el-form-item label=\"咨询问题\" prop=\"question\">\r\n          <el-input type=\"textarea\" v-model=\"consultForm.question\" rows=\"4\" placeholder=\"请详细描述您的问题...\"></el-input>\r\n        </el-form-item>\r\n        \r\n        <el-form-item label=\"紧急程度\" prop=\"urgency\">\r\n          <el-radio-group v-model=\"consultForm.urgency\">\r\n            <el-radio label=\"low\">普通</el-radio>\r\n            <el-radio label=\"medium\">较急</el-radio>\r\n            <el-radio label=\"high\">紧急</el-radio>\r\n          </el-radio-group>\r\n        </el-form-item>\r\n        \r\n        <el-form-item>\r\n          <el-button type=\"primary\" @click=\"submitConsult\" :loading=\"submitting\">提交咨询</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n      \r\n      <!-- 咨询详情对话框 -->\r\n      <el-dialog v-model=\"dialogVisible\" title=\"咨询详情\" width=\"60%\">\r\n        <div v-if=\"currentConsultation\">\r\n          <h3>{{ currentConsultation.subject }} 咨询</h3>\r\n          <el-descriptions :column=\"1\" border>\r\n            <el-descriptions-item label=\"咨询问题\">{{ currentConsultation.question }}</el-descriptions-item>\r\n            <el-descriptions-item label=\"提交时间\">{{ currentConsultation.date }}</el-descriptions-item>\r\n            <el-descriptions-item label=\"回复老师\">{{ currentConsultation.teacherName || '未分配' }}</el-descriptions-item>\r\n            <el-descriptions-item label=\"回复内容\">{{ currentConsultation.answer || '等待老师回复...' }}</el-descriptions-item>\r\n          </el-descriptions>\r\n          \r\n          <div class=\"chat-section\" v-if=\"currentConsultation.status === '已接受'\">\r\n            <h4>追加咨询</h4>\r\n            <div class=\"chat-messages\">\r\n              <div v-for=\"(msg, idx) in currentConsultation.messages\" :key=\"idx\" \r\n                   :class=\"['message', msg.sender === 'student' ? 'message-student' : 'message-teacher']\">\r\n                <div class=\"message-sender\">{{ msg.sender === 'student' ? '我' : currentConsultation.teacherName }}</div>\r\n                <div class=\"message-content\">{{ msg.content }}</div>\r\n                <div class=\"message-time\">{{ msg.time }}</div>\r\n              </div>\r\n            </div>\r\n            <div class=\"chat-input\">\r\n              <el-input v-model=\"messageInput\" placeholder=\"输入追加问题...\" rows=\"2\" type=\"textarea\"></el-input>\r\n              <el-button type=\"primary\" @click=\"sendMessage\" :disabled=\"!messageInput.trim()\">发送</el-button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </el-dialog>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios'\r\nimport { ElMessage } from 'element-plus'\r\n\r\nexport default {\r\n  name: \"OnlineConsult\",\r\n  data() {\r\n    return {\r\n      consultations: [],\r\n      consultForm: {\r\n        subject: '',\r\n        question: '',\r\n        urgency: 'medium'\r\n      },\r\n      rules: {\r\n        subject: [{ required: true, message: '请选择学科', trigger: 'change' }],\r\n        question: [{ required: true, message: '请输入咨询问题', trigger: 'blur' }],\r\n        urgency: [{ required: true, message: '请选择紧急程度', trigger: 'change' }]\r\n      },\r\n      submitting: false,\r\n      dialogVisible: false,\r\n      currentConsultation: null,\r\n      messageInput: ''\r\n    }\r\n  },\r\n  created() {\r\n    this.fetchConsultations()\r\n  },\r\n  methods: {\r\n    fetchConsultations() {\r\n      // 获取用户咨询历史\r\n      const userId = localStorage.getItem('userId')\r\n      if (!userId) {\r\n        ElMessage.warning('请先登录')\r\n        this.$router.push('/login')\r\n        return\r\n      }\r\n      \r\n      axios.get(`http://localhost:5000/api/consultations?userId=${userId}`)\r\n        .then(res => {\r\n          this.consultations = res.data || []\r\n        })\r\n        .catch(err => {\r\n          console.error('获取咨询历史失败', err)\r\n          ElMessage.error('获取咨询历史失败')\r\n        })\r\n    },\r\n    \r\n    submitConsult() {\r\n      this.$refs.consultForm.validate(valid => {\r\n        if (!valid) return\r\n        \r\n        this.submitting = true\r\n        const userId = localStorage.getItem('userId')\r\n        \r\n        if (!userId) {\r\n          ElMessage.warning('请先登录')\r\n          this.$router.push('/login')\r\n          return\r\n        }\r\n        \r\n        const consultation = {\r\n          ...this.consultForm,\r\n          userId,\r\n          date: new Date().toLocaleString(),\r\n          status: '等待中'\r\n        }\r\n        \r\n        axios.post('http://localhost:5000/api/consultations', consultation)\r\n          .then(res => {\r\n            ElMessage.success('咨询提交成功，请等待老师接单')\r\n            this.consultForm = {\r\n              subject: '',\r\n              question: '',\r\n              urgency: 'medium'\r\n            }\r\n            this.fetchConsultations()\r\n          })\r\n          .catch(err => {\r\n            console.error('提交咨询失败', err)\r\n            ElMessage.error('提交咨询失败')\r\n          })\r\n          .finally(() => {\r\n            this.submitting = false\r\n          })\r\n      })\r\n    },\r\n    \r\n    getStatusType(status) {\r\n      const types = {\r\n        '等待中': 'info',\r\n        '已接受': 'success',\r\n        '已完成': 'success',\r\n        '已拒绝': 'danger'\r\n      }\r\n      return types[status] || 'info'\r\n    },\r\n    \r\n    viewConsultation(row) {\r\n      axios.get(`http://localhost:5000/api/consultations/${row.id}`)\r\n        .then(res => {\r\n          this.currentConsultation = res.data\r\n          this.dialogVisible = true\r\n        })\r\n        .catch(err => {\r\n          console.error('获取咨询详情失败', err)\r\n          ElMessage.error('获取咨询详情失败')\r\n        })\r\n    },\r\n    \r\n    sendMessage() {\r\n      if (!this.messageInput.trim()) return\r\n      \r\n      const message = {\r\n        consultationId: this.currentConsultation.id,\r\n        content: this.messageInput,\r\n        sender: 'student',\r\n        time: new Date().toLocaleString()\r\n      }\r\n      \r\n      axios.post('http://localhost:5000/api/consultation-messages', message)\r\n        .then(res => {\r\n          // 添加到当前消息列表\r\n          if (!this.currentConsultation.messages) {\r\n            this.currentConsultation.messages = []\r\n          }\r\n          this.currentConsultation.messages.push(message)\r\n          this.messageInput = ''\r\n          \r\n          // 轮询获取老师回复\r\n          this.pollForTeacherResponse()\r\n        })\r\n        .catch(err => {\r\n          console.error('发送消息失败', err)\r\n          ElMessage.error('发送消息失败')\r\n        })\r\n    },\r\n    \r\n    pollForTeacherResponse() {\r\n      // 实际应用中可使用WebSocket实时通讯\r\n      const checkInterval = setInterval(() => {\r\n        axios.get(`http://localhost:5000/api/consultations/${this.currentConsultation.id}`)\r\n          .then(res => {\r\n            if (res.data.messages?.length > this.currentConsultation.messages?.length) {\r\n              this.currentConsultation = res.data\r\n              clearInterval(checkInterval)\r\n            }\r\n          })\r\n          .catch(err => {\r\n            console.error('轮询老师回复失败', err)\r\n            clearInterval(checkInterval)\r\n          })\r\n      }, 5000) // 每5秒检查一次\r\n      \r\n      // 30秒后停止轮询\r\n      setTimeout(() => {\r\n        clearInterval(checkInterval)\r\n      }, 30000)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.page-container {\r\n  padding: 20px;\r\n}\r\n.page-card {\r\n  max-width: 900px;\r\n  margin: 20px auto;\r\n  padding: 20px;\r\n}\r\n.consultation-history {\r\n  margin-bottom: 30px;\r\n}\r\n.empty-state {\r\n  margin: 40px 0;\r\n}\r\n.chat-section {\r\n  margin-top: 20px;\r\n  border-top: 1px solid #eee;\r\n  padding-top: 20px;\r\n}\r\n.chat-messages {\r\n  height: 300px;\r\n  overflow-y: auto;\r\n  border: 1px solid #eee;\r\n  border-radius: 4px;\r\n  padding: 10px;\r\n  margin-bottom: 15px;\r\n  background: #f9f9f9;\r\n}\r\n.message {\r\n  margin-bottom: 12px;\r\n  padding: 8px 12px;\r\n  border-radius: 8px;\r\n  max-width: 80%;\r\n}\r\n.message-student {\r\n  background: #ecf5ff;\r\n  margin-left: auto;\r\n  text-align: right;\r\n}\r\n.message-teacher {\r\n  background: #f0f9eb;\r\n}\r\n.message-sender {\r\n  font-weight: bold;\r\n  margin-bottom: 4px;\r\n  font-size: 0.9em;\r\n}\r\n.message-time {\r\n  font-size: 0.8em;\r\n  color: #999;\r\n  margin-top: 4px;\r\n}\r\n.chat-input {\r\n  display: flex;\r\n  gap: 10px;\r\n}\r\n.chat-input .el-textarea {\r\n  flex: 1;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}