(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-17e50148"],{"0d26":function(e,t,r){"use strict";var o=r("e330"),a=Error,i=o("".replace),s=function(e){return String(new a(e).stack)}("zxcasd"),l=/\n\s*at [^:]*:[^\n]*/,n=l.test(s);e.exports=function(e,t){if(n&&"string"==typeof e&&!a.prepareStackTrace)while(t--)e=i(e,l,"");return e}},1787:function(e,t,r){"use strict";var o=r("861d");e.exports=function(e){return o(e)||null===e}},"271a":function(e,t,r){"use strict";var o=r("cb2d"),a=r("e330"),i=r("577e"),s=r("d6d6"),l=URLSearchParams,n=l.prototype,c=a(n.getAll),d=a(n.has),u=new l("a=1");!u.has("a",2)&&u.has("a",void 0)||o(n,"has",(function(e){var t=arguments.length,r=t<2?void 0:arguments[1];if(t&&void 0===r)return d(this,e);var o=c(this,e);s(t,1);var a=i(r),l=0;while(l<o.length)if(o[l++]===a)return!0;return!1}),{enumerable:!0,unsafe:!0})},"2ba4":function(e,t,r){"use strict";var o=r("40d5"),a=Function.prototype,i=a.apply,s=a.call;e.exports="object"==typeof Reflect&&Reflect.apply||(o?s.bind(i):function(){return s.apply(i,arguments)})},"3bbe":function(e,t,r){"use strict";var o=r("1787"),a=String,i=TypeError;e.exports=function(e){if(o(e))return e;throw new i("Can't set "+a(e)+" as a prototype")}},4754:function(e,t,r){"use strict";e.exports=function(e,t){return{value:e,done:t}}},5494:function(e,t,r){"use strict";var o=r("83ab"),a=r("e330"),i=r("edd0"),s=URLSearchParams.prototype,l=a(s.forEach);o&&!("size"in s)&&i(s,"size",{get:function(){var e=0;return l(this,(function(){e++})),e},configurable:!0,enumerable:!0})},"577e":function(e,t,r){"use strict";var o=r("f5df"),a=String;e.exports=function(e){if("Symbol"===o(e))throw new TypeError("Cannot convert a Symbol value to a string");return a(e)}},6417:function(e,t,r){},6964:function(e,t,r){"use strict";var o=r("cb2d");e.exports=function(e,t,r){for(var a in t)o(e,a,t[a],r);return e}},"6c9d":function(e,t,r){"use strict";r("6417")},"6f19":function(e,t,r){"use strict";var o=r("9112"),a=r("0d26"),i=r("b980"),s=Error.captureStackTrace;e.exports=function(e,t,r,l){i&&(s?s(e,t):o(e,"stack",a(r,l)))}},7156:function(e,t,r){"use strict";var o=r("1626"),a=r("861d"),i=r("d2bb");e.exports=function(e,t,r){var s,l;return i&&o(s=t.constructor)&&s!==r&&a(l=s.prototype)&&l!==r.prototype&&i(e,l),e}},7282:function(e,t,r){"use strict";var o=r("e330"),a=r("59ed");e.exports=function(e,t,r){try{return o(a(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(i){}}},"88a7":function(e,t,r){"use strict";var o=r("cb2d"),a=r("e330"),i=r("577e"),s=r("d6d6"),l=URLSearchParams,n=l.prototype,c=a(n.append),d=a(n["delete"]),u=a(n.forEach),p=a([].push),h=new l("a=1&a=2&b=3");h["delete"]("a",1),h["delete"]("b",void 0),h+""!=="a=2"&&o(n,"delete",(function(e){var t=arguments.length,r=t<2?void 0:arguments[1];if(t&&void 0===r)return d(this,e);var o=[];u(this,(function(e,t){p(o,{key:t,value:e})})),s(t,1);var a,l=i(e),n=i(r),h=0,v=0,f=!1,m=o.length;while(h<m)a=o[h++],f||a.key===l?(f=!0,d(this,a.key)):v++;while(v<m)a=o[v++],a.key===l&&a.value===n||c(this,a.key,a.value)}),{enumerable:!0,unsafe:!0})},"910d":function(e,t,r){"use strict";var o=r("23e7"),a=r("c65b"),i=r("59ed"),s=r("825a"),l=r("46c4"),n=r("c5cc"),c=r("9bdd"),d=r("c430"),u=n((function(){var e,t,r,o=this.iterator,i=this.predicate,l=this.next;while(1){if(e=s(a(l,o)),t=this.done=!!e.done,t)return;if(r=e.value,c(o,i,[r,this.counter++],!0))return r}}));o({target:"Iterator",proto:!0,real:!0,forced:d},{filter:function(e){return s(this),i(e),new u(l(this),{predicate:e})}})},"9bdd":function(e,t,r){"use strict";var o=r("825a"),a=r("2a62");e.exports=function(e,t,r,i){try{return i?t(o(r)[0],r[1]):t(r)}catch(s){a(e,"throw",s)}}},ab36:function(e,t,r){"use strict";var o=r("861d"),a=r("9112");e.exports=function(e,t){o(t)&&"cause"in t&&a(e,"cause",t.cause)}},ab43:function(e,t,r){"use strict";var o=r("23e7"),a=r("d024"),i=r("c430");o({target:"Iterator",proto:!0,real:!0,forced:i},{map:a})},aeb0:function(e,t,r){"use strict";var o=r("9bf2").f;e.exports=function(e,t,r){r in e||o(e,r,{configurable:!0,get:function(){return t[r]},set:function(e){t[r]=e}})}},b980:function(e,t,r){"use strict";var o=r("d039"),a=r("5c6c");e.exports=!o((function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",a(1,7)),7!==e.stack)}))},c4da:function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"video-management"},[t("h2",[e._v("教学资源管理")]),t("el-card",{staticClass:"upload-section"},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("上传新视频")])]),t("el-form",{ref:"uploadForm",attrs:{model:e.uploadForm,rules:e.uploadRules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"视频标题",prop:"title"}},[t("el-input",{attrs:{placeholder:"请输入视频标题"},model:{value:e.uploadForm.title,callback:function(t){e.$set(e.uploadForm,"title",t)},expression:"uploadForm.title"}})],1),t("el-form-item",{attrs:{label:"学科分类",prop:"subject"}},[t("el-select",{attrs:{placeholder:"请选择学科分类"},model:{value:e.uploadForm.subject,callback:function(t){e.$set(e.uploadForm,"subject",t)},expression:"uploadForm.subject"}},[t("el-option",{attrs:{label:"数学",value:"math"}}),t("el-option",{attrs:{label:"物理",value:"physics"}}),t("el-option",{attrs:{label:"化学",value:"chemistry"}}),t("el-option",{attrs:{label:"生物",value:"biology"}}),t("el-option",{attrs:{label:"英语",value:"english"}}),t("el-option",{attrs:{label:"历史",value:"history"}}),t("el-option",{attrs:{label:"地理",value:"geography"}}),t("el-option",{attrs:{label:"政治",value:"politics"}})],1)],1),t("el-form-item",{attrs:{label:"年级",prop:"grade"}},[t("el-select",{attrs:{placeholder:"请选择年级"},model:{value:e.uploadForm.grade,callback:function(t){e.$set(e.uploadForm,"grade",t)},expression:"uploadForm.grade"}},[t("el-option",{attrs:{label:"一年级",value:"1"}}),t("el-option",{attrs:{label:"二年级",value:"2"}}),t("el-option",{attrs:{label:"三年级",value:"3"}}),t("el-option",{attrs:{label:"四年级",value:"4"}}),t("el-option",{attrs:{label:"五年级",value:"5"}}),t("el-option",{attrs:{label:"六年级",value:"6"}}),t("el-option",{attrs:{label:"初一",value:"7"}}),t("el-option",{attrs:{label:"初二",value:"8"}}),t("el-option",{attrs:{label:"初三",value:"9"}}),t("el-option",{attrs:{label:"高一",value:"10"}}),t("el-option",{attrs:{label:"高二",value:"11"}}),t("el-option",{attrs:{label:"高三",value:"12"}})],1)],1),t("el-form-item",{attrs:{label:"简介",prop:"description"}},[t("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"请输入视频简介"},model:{value:e.uploadForm.description,callback:function(t){e.$set(e.uploadForm,"description",t)},expression:"uploadForm.description"}})],1),t("el-form-item",{attrs:{label:"封面图",prop:"coverImage"}},[t("el-upload",{staticClass:"cover-uploader",attrs:{action:"/api/upload/image",name:"file",headers:e.uploadHeaders,"show-file-list":!1,"on-success":e.handleCoverSuccess,"on-error":(t,r)=>e.handleUploadError(t,r,"封面"),"before-upload":e.beforeCoverUpload}},[e.uploadForm.coverImageUrl?t("img",{staticClass:"cover-image",attrs:{src:e.uploadForm.coverImageUrl}}):t("i",{staticClass:"el-icon-plus cover-uploader-icon"})]),t("div",{staticClass:"upload-tip"},[e._v("请上传视频封面图片，建议尺寸16:9")])],1),t("el-form-item",{attrs:{label:"视频文件",prop:"videoFile"}},[t("el-upload",{staticClass:"video-uploader",attrs:{action:"/api/upload/video",name:"file",headers:e.uploadHeaders,"on-progress":e.onVideoUploadProgress,"on-success":e.handleVideoSuccess,"on-error":(t,r)=>e.handleUploadError(t,r,"视频"),"before-upload":e.beforeVideoUpload,limit:1,"file-list":e.videoList}},[t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("选择视频")]),t("div",{staticClass:"upload-tip"},[e._v("支持MP4, MOV格式，最大500MB")])],1),e.uploadProgress>0&&e.uploadProgress<100?t("el-progress",{attrs:{percentage:e.uploadProgress,"stroke-width":5}}):e._e()],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.uploading,disabled:!e.uploadForm.videoUrl},on:{click:e.submitUploadForm}},[e._v("保存视频")])],1)],1)],1),t("el-card",{staticClass:"video-list-section"},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("我的视频")]),t("el-input",{staticClass:"search-input",attrs:{placeholder:"搜索视频...",clearable:""},on:{clear:e.fetchVideos},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.fetchVideos.apply(null,arguments)}},model:{value:e.searchQuery,callback:function(t){e.searchQuery=t},expression:"searchQuery"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.fetchVideos},slot:"append"})],1)],1),t("div",{staticClass:"filter-section"},[t("el-select",{attrs:{placeholder:"学科",clearable:""},on:{change:e.fetchVideos},model:{value:e.filterSubject,callback:function(t){e.filterSubject=t},expression:"filterSubject"}},[t("el-option",{attrs:{label:"全部学科",value:""}}),t("el-option",{attrs:{label:"数学",value:"math"}}),t("el-option",{attrs:{label:"物理",value:"physics"}}),t("el-option",{attrs:{label:"化学",value:"chemistry"}}),t("el-option",{attrs:{label:"生物",value:"biology"}}),t("el-option",{attrs:{label:"英语",value:"english"}}),t("el-option",{attrs:{label:"历史",value:"history"}}),t("el-option",{attrs:{label:"地理",value:"geography"}}),t("el-option",{attrs:{label:"政治",value:"politics"}})],1),t("el-select",{attrs:{placeholder:"年级",clearable:""},on:{change:e.fetchVideos},model:{value:e.filterGrade,callback:function(t){e.filterGrade=t},expression:"filterGrade"}},[t("el-option",{attrs:{label:"全部年级",value:""}}),t("el-option",{attrs:{label:"一年级",value:"1"}}),t("el-option",{attrs:{label:"二年级",value:"2"}}),t("el-option",{attrs:{label:"三年级",value:"3"}}),t("el-option",{attrs:{label:"四年级",value:"4"}}),t("el-option",{attrs:{label:"五年级",value:"5"}}),t("el-option",{attrs:{label:"六年级",value:"6"}}),t("el-option",{attrs:{label:"初一",value:"7"}}),t("el-option",{attrs:{label:"初二",value:"8"}}),t("el-option",{attrs:{label:"初三",value:"9"}}),t("el-option",{attrs:{label:"高一",value:"10"}}),t("el-option",{attrs:{label:"高二",value:"11"}}),t("el-option",{attrs:{label:"高三",value:"12"}})],1),t("el-select",{attrs:{placeholder:"排序"},on:{change:e.fetchVideos},model:{value:e.sortBy,callback:function(t){e.sortBy=t},expression:"sortBy"}},[t("el-option",{attrs:{label:"最新上传",value:"createdAt_desc"}}),t("el-option",{attrs:{label:"最早上传",value:"createdAt_asc"}}),t("el-option",{attrs:{label:"播放量高",value:"viewCount_desc"}}),t("el-option",{attrs:{label:"标题排序",value:"title_asc"}})],1)],1),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[0!==e.videos.length||e.loading?t("div",{staticClass:"video-grid"},e._l(e.videos,(function(r){return t("el-card",{key:r._id,staticClass:"video-card",attrs:{shadow:"hover"}},[t("div",{staticClass:"video-thumbnail",on:{click:function(t){return e.previewVideo(r)}}},[t("img",{attrs:{src:r.coverImageUrl||e.defaultCover,alt:"视频封面"}}),t("div",{staticClass:"video-duration"},[e._v(e._s(e.formatDuration(r.duration)))]),t("div",{staticClass:"video-play-icon"},[t("i",{staticClass:"el-icon-video-play"})])]),t("div",{staticClass:"video-info"},[t("h3",{staticClass:"video-title",attrs:{title:r.title}},[e._v(e._s(r.title))]),t("p",{staticClass:"video-meta"},[t("span",[e._v("学科: "+e._s(e.getSubjectLabel(r.subject)))]),t("span",[e._v("年级: "+e._s(e.getGradeLabel(r.grade)))])]),t("p",{staticClass:"video-stats"},[t("span",[t("i",{staticClass:"el-icon-view"}),e._v(" "+e._s(r.viewCount||0))]),t("span",[t("i",{staticClass:"el-icon-time"}),e._v(" "+e._s(e.formatDate(r.createdAt)))])])]),t("div",{staticClass:"video-actions"},[t("el-dropdown",{on:{command:function(t){return e.handleVideoAction(t,r)}}},[t("span",{staticClass:"el-dropdown-link"},[e._v(" 操作"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"edit"}},[e._v("编辑")]),t("el-dropdown-item",{attrs:{command:"delete",divided:""}},[e._v("删除")])],1)],1)],1)])})),1):t("div",{staticClass:"empty-state"},[t("el-empty",{attrs:{description:"暂无视频"}})],1),e.videos.length>0?t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"",layout:"prev, pager, next, total",total:e.totalVideos,"page-size":e.pageSize,"current-page":e.currentPage},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"current-change":e.handlePageChange}})],1):e._e()])]),t("el-dialog",{attrs:{title:"编辑视频",visible:e.editDialogVisible,width:"50%"},on:{"update:visible":function(t){e.editDialogVisible=t}}},[t("el-form",{ref:"editForm",attrs:{model:e.editForm,rules:e.uploadRules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"视频标题",prop:"title"}},[t("el-input",{attrs:{placeholder:"请输入视频标题"},model:{value:e.editForm.title,callback:function(t){e.$set(e.editForm,"title",t)},expression:"editForm.title"}})],1),t("el-form-item",{attrs:{label:"学科分类",prop:"subject"}},[t("el-select",{attrs:{placeholder:"请选择学科分类"},model:{value:e.editForm.subject,callback:function(t){e.$set(e.editForm,"subject",t)},expression:"editForm.subject"}},[t("el-option",{attrs:{label:"数学",value:"math"}}),t("el-option",{attrs:{label:"物理",value:"physics"}}),t("el-option",{attrs:{label:"化学",value:"chemistry"}}),t("el-option",{attrs:{label:"生物",value:"biology"}}),t("el-option",{attrs:{label:"英语",value:"english"}}),t("el-option",{attrs:{label:"历史",value:"history"}}),t("el-option",{attrs:{label:"地理",value:"geography"}}),t("el-option",{attrs:{label:"政治",value:"politics"}})],1)],1),t("el-form-item",{attrs:{label:"年级",prop:"grade"}},[t("el-select",{attrs:{placeholder:"请选择年级"},model:{value:e.editForm.grade,callback:function(t){e.$set(e.editForm,"grade",t)},expression:"editForm.grade"}},[t("el-option",{attrs:{label:"一年级",value:"1"}}),t("el-option",{attrs:{label:"二年级",value:"2"}}),t("el-option",{attrs:{label:"三年级",value:"3"}}),t("el-option",{attrs:{label:"四年级",value:"4"}}),t("el-option",{attrs:{label:"五年级",value:"5"}}),t("el-option",{attrs:{label:"六年级",value:"6"}}),t("el-option",{attrs:{label:"初一",value:"7"}}),t("el-option",{attrs:{label:"初二",value:"8"}}),t("el-option",{attrs:{label:"初三",value:"9"}}),t("el-option",{attrs:{label:"高一",value:"10"}}),t("el-option",{attrs:{label:"高二",value:"11"}}),t("el-option",{attrs:{label:"高三",value:"12"}})],1)],1),t("el-form-item",{attrs:{label:"简介",prop:"description"}},[t("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"请输入视频简介"},model:{value:e.editForm.description,callback:function(t){e.$set(e.editForm,"description",t)},expression:"editForm.description"}})],1),t("el-form-item",{attrs:{label:"封面图"}},[t("el-upload",{staticClass:"cover-uploader",attrs:{action:e.offlineTestMode?"#":"/api/upload/image","http-request":e.offlineTestMode?e.handleOfflineCoverUpload:void 0,"show-file-list":!1,"on-success":(t,r)=>e.handleEditCoverSuccess(t,r),"before-upload":e.beforeCoverUpload}},[e.editForm.coverImageUrl?t("img",{staticClass:"cover-image",attrs:{src:e.editForm.coverImageUrl}}):t("i",{staticClass:"el-icon-plus cover-uploader-icon"})])],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitEditForm}},[e._v("保存")])],1)],1),t("el-dialog",{attrs:{title:"视频预览",visible:e.previewDialogVisible,width:"80%","custom-class":"video-preview-dialog"},on:{"update:visible":function(t){e.previewDialogVisible=t}}},[e.currentVideo?t("div",{staticClass:"video-preview-container"},[t("video",{ref:"videoPlayer",staticClass:"video-player",attrs:{controls:"",autoplay:"",src:e.currentVideo.videoUrl},on:{timeupdate:e.onVideoTimeUpdate}}),t("div",{staticClass:"video-preview-info"},[t("h2",[e._v(e._s(e.currentVideo.title))]),t("p",{staticClass:"video-preview-meta"},[t("span",[e._v("学科: "+e._s(e.getSubjectLabel(e.currentVideo.subject)))]),t("span",[e._v("年级: "+e._s(e.getGradeLabel(e.currentVideo.grade)))]),t("span",[e._v("上传时间: "+e._s(e.formatDate(e.currentVideo.createdAt)))]),t("span",[e._v("播放次数: "+e._s(e.currentVideo.viewCount||0))])]),t("p",{staticClass:"video-preview-description"},[e._v(e._s(e.currentVideo.description))])])]):e._e()])],1)},a=[],i=(r("d9e2"),r("e9f5"),r("910d"),r("ab43"),r("88a7"),r("271a"),r("5494"),{name:"VideoManagement",data(){return{uploadForm:{title:"",subject:"",grade:"",description:"",coverImageUrl:"",videoUrl:"",duration:0},uploadRules:{title:[{required:!0,message:"请输入视频标题",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],subject:[{required:!0,message:"请选择学科分类",trigger:"change"}],grade:[{required:!0,message:"请选择年级",trigger:"change"}],description:[{required:!0,message:"请输入视频简介",trigger:"blur"},{min:5,max:500,message:"长度在 5 到 500 个字符",trigger:"blur"}]},uploading:!1,uploadProgress:0,videoList:[],defaultCover:"https://cube.elemecdn.com/9/c2/f0ee8a3c7c9638a54940382568c9dpng.png",loading:!1,videos:[],totalVideos:0,currentPage:1,pageSize:12,searchQuery:"",filterSubject:"",filterGrade:"",sortBy:"createdAt_desc",editDialogVisible:!1,editForm:{_id:"",title:"",subject:"",grade:"",description:"",coverImageUrl:""},previewDialogVisible:!1,currentVideo:null,offlineTestMode:!1,uploadHeaders:{}}},methods:{handleCoverSuccess(e,t){if(this.offlineTestMode){const e={success:!0,message:"封面上传成功",data:{url:URL.createObjectURL(t.raw)}};this.uploadForm.coverImageUrl=e.data.url,this.$message.success("封面上传成功")}else this.uploadForm.coverImageUrl=e.data.url},beforeCoverUpload(e){const t=0===e.type.indexOf("image/"),r=e.size/1024/1024<2;return t||this.$message.error("只能上传图片文件!"),r||this.$message.error("图片大小不能超过 2MB!"),t&&r},onVideoUploadProgress(e){e.percent&&(this.uploadProgress=parseInt(e.percent))},handleVideoSuccess(e,t){this.uploadProgress=100,this.offlineTestMode?(this.uploadForm.videoUrl=URL.createObjectURL(t.raw),this.uploadForm.duration=120,this.$message.success("视频上传成功")):(this.uploadForm.videoUrl=e.data.url,this.uploadForm.duration=e.data.duration||0),setTimeout(()=>{this.uploadProgress=0},2e3)},handleVideoError(e){this.uploadProgress=0,this.$message.error("视频上传失败，请重试"),console.error("视频上传失败:",e)},beforeVideoUpload(e){const t=0===e.type.indexOf("video/"),r=e.size/1024/1024<500;return t||this.$message.error("只能上传视频文件!"),r||this.$message.error("视频大小不能超过 500MB!"),t&&r},submitUploadForm(){this.$refs.uploadForm.validate(e=>{if(e){if(!this.uploadForm.videoUrl)return void this.$message.error("请先上传视频文件");this.uploading=!0;const e={title:this.uploadForm.title,subject:this.uploadForm.subject,grade:this.uploadForm.grade,description:this.uploadForm.description,coverImageUrl:this.uploadForm.coverImageUrl||this.defaultCover,videoUrl:this.uploadForm.videoUrl,duration:this.uploadForm.duration};this.offlineTestMode?(console.log("离线测试模式: 模拟视频保存",e),this.$message.success("视频保存成功"),this.resetUploadForm(),this.uploading=!1,this.fetchVideos()):this.$http.post("/api/videos",e).then(()=>{this.$message.success("视频保存成功"),this.resetUploadForm(),this.fetchVideos()}).catch(e=>{console.error("保存视频失败:",e),this.$message.error("保存视频失败，请重试")}).finally(()=>{this.uploading=!1})}})},resetUploadForm(){this.$refs.uploadForm.resetFields(),this.uploadForm.coverImageUrl="",this.uploadForm.videoUrl="",this.uploadForm.duration=0,this.videoList=[]},fetchVideos(){if(this.loading=!0,this.offlineTestMode)return void setTimeout(()=>{this.videos=Array(12).fill().map((e,t)=>({_id:"video_"+t,title:"示例视频 "+(t+1),subject:["math","physics","chemistry","biology","english"][t%5],grade:String(7+t%6),description:`这是一个示例视频的详细描述，用于测试界面显示效果。第 ${t+1} 个视频。`,coverImageUrl:"https://via.placeholder.com/320x180?text=Video+"+(t+1),videoUrl:"https://www.w3schools.com/html/mov_bbb.mp4",duration:60+30*t,viewCount:Math.floor(1e3*Math.random()),createdAt:new Date(Date.now()-864e5*t).toISOString()})),this.totalVideos=36,this.loading=!1},500);const e={page:this.currentPage,limit:this.pageSize,search:this.searchQuery,subject:this.filterSubject,grade:this.filterGrade,sort:this.sortBy};this.$http.get("/api/videos",{params:e}).then(e=>{this.videos=e.data.videos||[],this.totalVideos=e.data.total||0}).catch(e=>{console.error("获取视频列表失败:",e),this.$message.error("获取视频列表失败，请重试"),this.videos=[],this.totalVideos=0}).finally(()=>{this.loading=!1})},handlePageChange(e){this.currentPage=e,this.fetchVideos()},handleVideoAction(e,t){"edit"===e?this.editVideo(t):"delete"===e&&this.confirmDeleteVideo(t)},editVideo(e){this.editForm={...e},this.editDialogVisible=!0},handleEditCoverSuccess(e,t){if(this.offlineTestMode){const e={success:!0,message:"封面上传成功",data:{url:URL.createObjectURL(t.raw)}};this.editForm.coverImageUrl=e.data.url,this.$message.success("封面上传成功")}else this.editForm.coverImageUrl=e.data.url},submitEditForm(){this.$refs.editForm.validate(e=>{if(e)if(this.offlineTestMode){console.log("离线测试模式: 模拟视频更新",this.editForm);const e=this.videos.findIndex(e=>e._id===this.editForm._id);-1!==e&&(this.videos[e]={...this.videos[e],...this.editForm}),this.$message.success("视频更新成功"),this.editDialogVisible=!1}else this.$http.put("/api/videos/"+this.editForm._id,this.editForm).then(()=>{this.$message.success("视频更新成功"),this.editDialogVisible=!1,this.fetchVideos()}).catch(e=>{console.error("更新视频失败:",e),this.$message.error("更新视频失败，请重试")})})},confirmDeleteVideo(e){this.$confirm(`确定要删除视频"${e.title}"吗？删除后不可恢复。`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.deleteVideo(e._id)}).catch(()=>{})},deleteVideo(e){this.offlineTestMode?(console.log("离线测试模式: 模拟视频删除",e),this.videos=this.videos.filter(t=>t._id!==e),this.$message.success("视频删除成功")):this.$http.delete("/api/videos/"+e).then(()=>{this.$message.success("视频删除成功"),this.fetchVideos()}).catch(e=>{console.error("删除视频失败:",e),this.$message.error("删除视频失败，请重试")})},previewVideo(e){this.currentVideo=e,this.previewDialogVisible=!0,this.offlineTestMode||this.$http.post(`/api/videos/${e._id}/view`).catch(e=>console.error("记录播放次数失败:",e))},onVideoTimeUpdate(){this.$refs.videoPlayer},formatDuration(e){if(!e)return"00:00";const t=Math.floor(e/60),r=Math.floor(e%60);return`${t.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},formatDate(e){if(!e)return"";const t=new Date(e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`},getSubjectLabel(e){const t={math:"数学",physics:"物理",chemistry:"化学",biology:"生物",english:"英语",history:"历史",geography:"地理",politics:"政治"};return t[e]||e},getGradeLabel(e){const t={1:"一年级",2:"二年级",3:"三年级",4:"四年级",5:"五年级",6:"六年级",7:"初一",8:"初二",9:"初三",10:"高一",11:"高二",12:"高三"};return t[e]||e},handleOfflineUpload(e){const{file:t,onProgress:r,onSuccess:o,onError:a}=e,i=setInterval(()=>{const e=Math.min(99,this.uploadProgress+10);this.uploadProgress=e,r({percent:e})},300);setTimeout(()=>{clearInterval(i);try{if(0!==t.type.indexOf("video/"))return void a(new Error("只能上传视频文件"));const e={success:!0,message:"视频上传成功",data:{url:URL.createObjectURL(t),duration:Math.floor(300*Math.random())+60}};o(e,t),this.$message.success("视频上传成功")}catch(e){a(e),this.$message.error("视频上传失败")}},2e3)},handleOfflineCoverUpload(e){const{file:t,onProgress:r,onSuccess:o,onError:a}=e,i=setInterval(()=>{const e=Math.min(99,this.uploadProgress+10);this.uploadProgress=e,r({percent:e})},300);setTimeout(()=>{clearInterval(i);try{if(0!==t.type.indexOf("image/"))return void a(new Error("只能上传图片文件"));const e={success:!0,message:"封面上传成功",data:{url:URL.createObjectURL(t)}};o(e,t),this.$message.success("封面上传成功")}catch(e){a(e),this.$message.error("封面上传失败")}},2e3)},handleUploadError(e,t,r){console.error(r+"上传失败:",e),this.$message.error(r+"上传失败，请重试")}},created(){this.fetchVideos();const e=localStorage.getItem("token");e&&(this.uploadHeaders={Authorization:"Bearer "+e})}}),s=i,l=(r("6c9d"),r("2877")),n=Object(l["a"])(s,o,a,!1,null,"d070b0f2",null);t["default"]=n.exports},c5cc:function(e,t,r){"use strict";var o=r("c65b"),a=r("7c73"),i=r("9112"),s=r("6964"),l=r("b622"),n=r("69f3"),c=r("dc4a"),d=r("ae93").IteratorPrototype,u=r("4754"),p=r("2a62"),h=l("toStringTag"),v="IteratorHelper",f="WrapForValidIterator",m=n.set,g=function(e){var t=n.getterFor(e?f:v);return s(a(d),{next:function(){var r=t(this);if(e)return r.nextHandler();if(r.done)return u(void 0,!0);try{var o=r.nextHandler();return r.returnHandlerResult?o:u(o,r.done)}catch(a){throw r.done=!0,a}},return:function(){var r=t(this),a=r.iterator;if(r.done=!0,e){var i=c(a,"return");return i?o(i,a):u(void 0,!0)}if(r.inner)try{p(r.inner.iterator,"normal")}catch(s){return p(a,"throw",s)}return a&&p(a,"normal"),u(void 0,!0)}})},b=g(!0),y=g(!1);i(y,h,"Iterator Helper"),e.exports=function(e,t,r){var o=function(o,a){a?(a.iterator=o.iterator,a.next=o.next):a=o,a.type=t?f:v,a.returnHandlerResult=!!r,a.nextHandler=e,a.counter=0,a.done=!1,m(this,a)};return o.prototype=t?b:y,o}},d024:function(e,t,r){"use strict";var o=r("c65b"),a=r("59ed"),i=r("825a"),s=r("46c4"),l=r("c5cc"),n=r("9bdd"),c=l((function(){var e=this.iterator,t=i(o(this.next,e)),r=this.done=!!t.done;if(!r)return n(e,this.mapper,[t.value,this.counter++],!0)}));e.exports=function(e){return i(this),a(e),new c(s(this),{mapper:e})}},d2bb:function(e,t,r){"use strict";var o=r("7282"),a=r("861d"),i=r("1d80"),s=r("3bbe");e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{e=o(Object.prototype,"__proto__","set"),e(r,[]),t=r instanceof Array}catch(l){}return function(r,o){return i(r),s(o),a(r)?(t?e(r,o):r.__proto__=o,r):r}}():void 0)},d6d6:function(e,t,r){"use strict";var o=TypeError;e.exports=function(e,t){if(e<t)throw new o("Not enough arguments");return e}},d9e2:function(e,t,r){"use strict";var o=r("23e7"),a=r("cfe9"),i=r("2ba4"),s=r("e5cb"),l="WebAssembly",n=a[l],c=7!==new Error("e",{cause:7}).cause,d=function(e,t){var r={};r[e]=s(e,t,c),o({global:!0,constructor:!0,arity:1,forced:c},r)},u=function(e,t){if(n&&n[e]){var r={};r[e]=s(l+"."+e,t,c),o({target:l,stat:!0,constructor:!0,arity:1,forced:c},r)}};d("Error",(function(e){return function(t){return i(e,this,arguments)}})),d("EvalError",(function(e){return function(t){return i(e,this,arguments)}})),d("RangeError",(function(e){return function(t){return i(e,this,arguments)}})),d("ReferenceError",(function(e){return function(t){return i(e,this,arguments)}})),d("SyntaxError",(function(e){return function(t){return i(e,this,arguments)}})),d("TypeError",(function(e){return function(t){return i(e,this,arguments)}})),d("URIError",(function(e){return function(t){return i(e,this,arguments)}})),u("CompileError",(function(e){return function(t){return i(e,this,arguments)}})),u("LinkError",(function(e){return function(t){return i(e,this,arguments)}})),u("RuntimeError",(function(e){return function(t){return i(e,this,arguments)}}))},e391:function(e,t,r){"use strict";var o=r("577e");e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:o(e)}},e5cb:function(e,t,r){"use strict";var o=r("d066"),a=r("1a2d"),i=r("9112"),s=r("3a9b"),l=r("d2bb"),n=r("e893"),c=r("aeb0"),d=r("7156"),u=r("e391"),p=r("ab36"),h=r("6f19"),v=r("83ab"),f=r("c430");e.exports=function(e,t,r,m){var g="stackTraceLimit",b=m?2:1,y=e.split("."),w=y[y.length-1],F=o.apply(null,y);if(F){var _=F.prototype;if(!f&&a(_,"cause")&&delete _.cause,!r)return F;var V=o("Error"),x=t((function(e,t){var r=u(m?t:e,void 0),o=m?new F(e):new F;return void 0!==r&&i(o,"message",r),h(o,x,o.stack,2),this&&s(_,this)&&d(o,this,x),arguments.length>b&&p(o,arguments[b]),o}));if(x.prototype=_,"Error"!==w?l?l(x,V):n(x,V,{name:!0}):v&&g in F&&(c(x,F,g),c(x,F,"prepareStackTrace")),n(x,F),!f)try{_.name!==w&&i(_,"name",w),_.constructor=x}catch(C){}return x}}}}]);
//# sourceMappingURL=chunk-17e50148.4c168079.js.map