{"ast":null,"code":"import { ref, onMounted } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { getConsultationById, cancelConsultation } from '../../services/consultationService';\nimport { getCurrentUser } from '../../services/authService';\nexport default {\n  name: 'ConsultationDetail',\n  setup() {\n    const route = useRoute();\n    const router = useRouter();\n    const id = route.params.id;\n    const currentUser = getCurrentUser();\n    const consultation = ref(null);\n    const loading = ref(true);\n    const error = ref('');\n\n    // 加载咨询详情\n    onMounted(async () => {\n      try {\n        loading.value = true;\n        const consultationData = await getConsultationById(id);\n        consultation.value = consultationData;\n        loading.value = false;\n      } catch (err) {\n        error.value = err.message || '加载咨询详情失败';\n        loading.value = false;\n        console.error('加载咨询详情错误:', err);\n      }\n    });\n\n    // 取消咨询请求\n    const handleCancel = async () => {\n      if (!confirm('确定要取消这个咨询请求吗？')) {\n        return;\n      }\n      try {\n        await cancelConsultation(id);\n        consultation.value.status = 'canceled';\n      } catch (err) {\n        alert(`取消咨询失败: ${err.message}`);\n        console.error('取消咨询错误:', err);\n      }\n    };\n\n    // 格式化日期\n    const formatDate = dateString => {\n      const date = new Date(dateString);\n      return date.toLocaleString('zh-CN', {\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    };\n\n    // 获取状态文本\n    const getStatusText = status => {\n      switch (status) {\n        case 'pending':\n          return '等待教师接受';\n        case 'accepted':\n          return '教师已接受';\n        case 'rejected':\n          return '教师已婉拒';\n        case 'completed':\n          return '咨询已完成';\n        case 'canceled':\n          return '咨询已取消';\n        default:\n          return status;\n      }\n    };\n\n    // 获取状态标志\n    const getStatusBadge = status => {\n      switch (status) {\n        case 'pending':\n          return '等待教师接受';\n        case 'accepted':\n          return '教师已接受';\n        case 'rejected':\n          return '教师已婉拒';\n        case 'completed':\n          return '咨询已完成';\n        case 'canceled':\n          return '咨询已取消';\n        default:\n          return status;\n      }\n    };\n\n    // 获取状态类名\n    const getStatusClass = status => {\n      switch (status) {\n        case 'pending':\n          return 'status-pending';\n        case 'accepted':\n          return 'status-accepted';\n        case 'rejected':\n          return 'status-rejected';\n        case 'completed':\n          return 'status-completed';\n        case 'canceled':\n          return 'status-canceled';\n        default:\n          return '';\n      }\n    };\n    return {\n      consultation,\n      loading,\n      error,\n      handleCancel,\n      formatDate,\n      getStatusText,\n      getStatusBadge,\n      getStatusClass\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","useRoute","useRouter","getConsultationById","cancelConsultation","getCurrentUser","name","setup","route","router","id","params","currentUser","consultation","loading","error","value","consultationData","err","message","console","handleCancel","confirm","status","alert","formatDate","dateString","date","Date","toLocaleString","year","month","day","hour","minute","getStatusText","getStatusBadge","getStatusClass"],"sources":["D:\\Code\\coding\\edu-platform\\client\\src\\views\\student\\ConsultationDetail.vue"],"sourcesContent":["<template>\r\n  <div class=\"consultation-detail-page\">\r\n    <div class=\"consultation-header\">\r\n      <h1>启明隅在线咨询 - 详情</h1>\r\n    </div>\r\n\r\n    <div v-if=\"loading\" class=\"loading-state\">\r\n      <i class=\"fas fa-spinner fa-spin\"></i>\r\n      <p>加载咨询详情中...</p>\r\n    </div>\r\n\r\n    <div v-else-if=\"error\" class=\"error-state\">\r\n      <i class=\"fas fa-exclamation-circle\"></i>\r\n      <p>{{ error }}</p>\r\n      <router-link to=\"/student/consultations\" class=\"back-button\">\r\n        返回咨询列表\r\n      </router-link>\r\n    </div>\r\n\r\n    <div v-else class=\"consultation-content\">\r\n      <div class=\"detail-card\">\r\n        <div class=\"card-header\">\r\n          <h2>咨询信息</h2>\r\n          <div :class=\"['status-badge', getStatusClass(consultation.status)]\">\r\n            {{ getStatusBadge(consultation.status) }}\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"detail-info\">\r\n          <div class=\"info-item\">\r\n            <span class=\"info-label\">科目:</span>\r\n            <span class=\"info-value\">{{ consultation.subject }}</span>\r\n          </div>\r\n\r\n          <div class=\"info-item\">\r\n            <span class=\"info-label\">主题:</span>\r\n            <span class=\"info-value\">{{ consultation.title }}</span>\r\n          </div>\r\n\r\n          <div class=\"info-item\">\r\n            <span class=\"info-label\">描述:</span>\r\n            <p class=\"info-value description\">{{ consultation.description }}</p>\r\n          </div>\r\n\r\n          <div class=\"info-item\">\r\n            <span class=\"info-label\">教师:</span>\r\n            <div class=\"teacher-info\">\r\n              <img :src=\"consultation.teacher.avatar || '/images/default-avatar.jpg'\" :alt=\"consultation.teacher.name\"\r\n                class=\"teacher-avatar\" />\r\n              <span class=\"teacher-name\">{{ consultation.teacher.name }}</span>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"info-item\">\r\n            <span class=\"info-label\">创建时间:</span>\r\n            <span class=\"info-value\">{{ formatDate(consultation.createdAt) }}</span>\r\n          </div>\r\n\r\n          <div v-if=\"consultation.scheduledTime\" class=\"info-item\">\r\n            <span class=\"info-label\">预约时间:</span>\r\n            <span class=\"info-value\">{{ formatDate(consultation.scheduledTime) }}</span>\r\n          </div>\r\n        </div>\r\n\r\n        <div v-if=\"consultation.status === 'rejected'\" class=\"rejection-reason\">\r\n          <h3>拒绝原因</h3>\r\n          <p>{{ consultation.rejectionReason || '教师未提供拒绝原因' }}</p>\r\n        </div>\r\n\r\n        <div class=\"detail-actions\">\r\n          <router-link to=\"/student/consultations\" class=\"back-link\">\r\n            <i class=\"fas fa-arrow-left\"></i> 返回列表\r\n          </router-link>\r\n\r\n          <div class=\"action-buttons\">\r\n            <button v-if=\"consultation.status === 'pending'\" @click=\"handleCancel\" class=\"cancel-btn\">\r\n              <i class=\"fas fa-times\"></i> 取消咨询\r\n            </button>\r\n\r\n            <router-link v-if=\"consultation.status === 'accepted'\"\r\n              :to=\"`/student/consultation/room/${consultation._id}`\" class=\"enter-room-btn\">\r\n              <i class=\"fas fa-door-open\"></i> 进入咨询室\r\n            </router-link>\r\n\r\n            <router-link v-if=\"consultation.status === 'completed' && !consultation.feedback\"\r\n              :to=\"`/student/consultation/feedback/${consultation._id}`\" class=\"feedback-btn\">\r\n              <i class=\"fas fa-star\"></i> 评价咨询\r\n            </router-link>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div v-if=\"consultation.feedback\" class=\"feedback-card\">\r\n        <h2>我的评价</h2>\r\n        <div class=\"feedback-content\">\r\n          <div class=\"rating\">\r\n            <span class=\"rating-label\">评分:</span>\r\n            <div class=\"stars\">\r\n              <i v-for=\"i in 5\" :key=\"i\"\r\n                :class=\"['fas', i <= consultation.feedback.rating ? 'fa-star' : 'fa-star-o']\"></i>\r\n            </div>\r\n            <span class=\"rating-value\">{{ consultation.feedback.rating }}/5</span>\r\n          </div>\r\n\r\n          <div v-if=\"consultation.feedback.comment\" class=\"comment\">\r\n            <span class=\"comment-label\">评价内容:</span>\r\n            <p class=\"comment-text\">{{ consultation.feedback.comment }}</p>\r\n          </div>\r\n\r\n          <div class=\"feedback-time\">\r\n            <i class=\"far fa-clock\"></i>\r\n            <span>评价时间: {{ formatDate(consultation.feedback.createdAt) }}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, onMounted } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { getConsultationById, cancelConsultation } from '../../services/consultationService'\r\nimport { getCurrentUser } from '../../services/authService'\r\n\r\nexport default {\r\n  name: 'ConsultationDetail',\r\n  setup() {\r\n    const route = useRoute()\r\n    const router = useRouter()\r\n    const id = route.params.id\r\n    const currentUser = getCurrentUser()\r\n\r\n    const consultation = ref(null)\r\n    const loading = ref(true)\r\n    const error = ref('')\r\n\r\n    // 加载咨询详情\r\n    onMounted(async () => {\r\n      try {\r\n        loading.value = true\r\n        const consultationData = await getConsultationById(id)\r\n        consultation.value = consultationData\r\n        loading.value = false\r\n      } catch (err) {\r\n        error.value = err.message || '加载咨询详情失败'\r\n        loading.value = false\r\n        console.error('加载咨询详情错误:', err)\r\n      }\r\n    })\r\n\r\n    // 取消咨询请求\r\n    const handleCancel = async () => {\r\n      if (!confirm('确定要取消这个咨询请求吗？')) {\r\n        return\r\n      }\r\n\r\n      try {\r\n        await cancelConsultation(id)\r\n        consultation.value.status = 'canceled'\r\n      } catch (err) {\r\n        alert(`取消咨询失败: ${err.message}`)\r\n        console.error('取消咨询错误:', err)\r\n      }\r\n    }\r\n\r\n    // 格式化日期\r\n    const formatDate = (dateString) => {\r\n      const date = new Date(dateString)\r\n      return date.toLocaleString('zh-CN', {\r\n        year: 'numeric',\r\n        month: 'long',\r\n        day: 'numeric',\r\n        hour: '2-digit',\r\n        minute: '2-digit'\r\n      })\r\n    }\r\n\r\n    // 获取状态文本\r\n    const getStatusText = (status) => {\r\n      switch (status) {\r\n        case 'pending': return '等待教师接受'\r\n        case 'accepted': return '教师已接受'\r\n        case 'rejected': return '教师已婉拒'\r\n        case 'completed': return '咨询已完成'\r\n        case 'canceled': return '咨询已取消'\r\n        default: return status\r\n      }\r\n    }\r\n\r\n    // 获取状态标志\r\n    const getStatusBadge = (status) => {\r\n      switch (status) {\r\n        case 'pending':\r\n          return '等待教师接受'\r\n        case 'accepted':\r\n          return '教师已接受'\r\n        case 'rejected':\r\n          return '教师已婉拒'\r\n        case 'completed':\r\n          return '咨询已完成'\r\n        case 'canceled':\r\n          return '咨询已取消'\r\n        default:\r\n          return status\r\n      }\r\n    }\r\n\r\n    // 获取状态类名\r\n    const getStatusClass = (status) => {\r\n      switch (status) {\r\n        case 'pending': return 'status-pending'\r\n        case 'accepted': return 'status-accepted'\r\n        case 'rejected': return 'status-rejected'\r\n        case 'completed': return 'status-completed'\r\n        case 'canceled': return 'status-canceled'\r\n        default: return ''\r\n      }\r\n    }\r\n\r\n    return {\r\n      consultation,\r\n      loading,\r\n      error,\r\n      handleCancel,\r\n      formatDate,\r\n      getStatusText,\r\n      getStatusBadge,\r\n      getStatusClass\r\n    }\r\n  }\r\n}\r\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}