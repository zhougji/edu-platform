{"ast":null,"code":"import { ref, reactive, onMounted } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { getConsultationById, submitFeedback } from '../../services/consultationService';\nexport default {\n  name: 'ConsultationFeedback',\n  setup() {\n    const route = useRoute();\n    const router = useRouter();\n    const {\n      id\n    } = route.params;\n    const consultation = ref(null);\n    const loading = ref(true);\n    const error = ref('');\n    const submitting = ref(false);\n    const submitError = ref('');\n    const feedback = reactive({\n      rating: 0,\n      comment: ''\n    });\n\n    // 加载咨询详情\n    onMounted(async () => {\n      try {\n        loading.value = true;\n        error.value = '';\n        const data = await getConsultationById(id);\n        if (data.status !== 'completed') {\n          error.value = '只能对已完成的咨询进行评价';\n          loading.value = false;\n          return;\n        }\n        consultation.value = data;\n        loading.value = false;\n      } catch (err) {\n        error.value = err.message || '加载咨询详情失败';\n        loading.value = false;\n        console.error('加载咨询详情错误:', err);\n      }\n    });\n\n    // 提交评价\n    const handleSubmit = async () => {\n      try {\n        if (!feedback.rating) {\n          submitError.value = '请选择满意度评分';\n          return;\n        }\n        submitting.value = true;\n        submitError.value = '';\n        await submitFeedback(id, feedback);\n\n        // 提交成功后跳转\n        router.push({\n          path: '/student/consultations',\n          query: {\n            feedbackSuccess: 'true'\n          }\n        });\n      } catch (err) {\n        submitError.value = err.message || '提交评价失败，请重试';\n        submitting.value = false;\n        console.error('提交评价错误:', err);\n      }\n    };\n    return {\n      consultation,\n      loading,\n      error,\n      submitting,\n      submitError,\n      feedback,\n      handleSubmit\n    };\n  }\n};","map":{"version":3,"names":["ref","reactive","onMounted","useRoute","useRouter","getConsultationById","submitFeedback","name","setup","route","router","id","params","consultation","loading","error","submitting","submitError","feedback","rating","comment","value","data","status","err","message","console","handleSubmit","push","path","query","feedbackSuccess"],"sources":["D:\\Code\\coding\\edu-platform\\client\\src\\views\\student\\ConsultationFeedback.vue"],"sourcesContent":["<template>\r\n    <div class=\"consultation-feedback-page\">\r\n        <div class=\"feedback-header\">\r\n            <h1>启明隅在线咨询 - 评价反馈</h1>\r\n            <p>您的反馈将帮助我们提供更好的服务</p>\r\n        </div>\r\n\r\n        <div v-if=\"loading\" class=\"loading-state\">\r\n            <i class=\"fas fa-spinner fa-spin\"></i>\r\n            <p>加载中...</p>\r\n        </div>\r\n\r\n        <div v-else-if=\"error\" class=\"feedback-error\">\r\n            <i class=\"fas fa-exclamation-circle\"></i>\r\n            <span>{{ error }}</span>\r\n            <router-link to=\"/student/consultations\" class=\"back-button\">\r\n                返回咨询列表\r\n            </router-link>\r\n        </div>\r\n\r\n        <div v-else class=\"feedback-content\">\r\n            <div class=\"consultant-info\">\r\n                <img :src=\"consultation.teacher.avatar || '/images/default-avatar.jpg'\" :alt=\"consultation.teacher.name\"\r\n                    class=\"teacher-avatar\" />\r\n                <div class=\"teacher-details\">\r\n                    <h3>{{ consultation.teacher.name }}</h3>\r\n                    <p>{{ consultation.subject }} 教师</p>\r\n                </div>\r\n            </div>\r\n\r\n            <div class=\"feedback-form-container\">\r\n                <div class=\"feedback-form-header\">\r\n                    <h2>为{{ consultation.teacher.name }}老师的咨询服务评分</h2>\r\n                    <p>请根据此次咨询体验进行评价</p>\r\n                </div>\r\n\r\n                <div v-if=\"submitError\" class=\"error-message\">\r\n                    <i class=\"fas fa-exclamation-circle\"></i>\r\n                    <span>{{ submitError }}</span>\r\n                </div>\r\n\r\n                <form @submit.prevent=\"handleSubmit\" class=\"feedback-form\">\r\n                    <div class=\"rating-section\">\r\n                        <label>服务满意度</label>\r\n                        <div class=\"star-rating\">\r\n                            <button v-for=\"n in 5\" :key=\"n\" type=\"button\"\r\n                                :class=\"['star-btn', n <= feedback.rating ? 'active' : '']\"\r\n                                @click=\"feedback.rating = n\">\r\n                                <i class=\"fas fa-star\"></i>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div class=\"form-group\">\r\n                        <label for=\"comment\">评价内容</label>\r\n                        <textarea id=\"comment\" v-model=\"feedback.comment\" rows=\"5\"\r\n                            placeholder=\"请分享您对此次咨询的评价和建议...\"></textarea>\r\n                    </div>\r\n\r\n                    <button type=\"submit\" class=\"submit-btn\" :disabled=\"submitting || !feedback.rating\">\r\n                        <template v-if=\"submitting\">\r\n                            <i class=\"fas fa-spinner fa-spin\"></i> 提交中...\r\n                        </template>\r\n                        <template v-else>\r\n                            <i class=\"fas fa-paper-plane\"></i> 提交评价\r\n                        </template>\r\n                    </button>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, reactive, onMounted } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { getConsultationById, submitFeedback } from '../../services/consultationService'\r\n\r\nexport default {\r\n    name: 'ConsultationFeedback',\r\n    setup() {\r\n        const route = useRoute()\r\n        const router = useRouter()\r\n        const { id } = route.params\r\n\r\n        const consultation = ref(null)\r\n        const loading = ref(true)\r\n        const error = ref('')\r\n        const submitting = ref(false)\r\n        const submitError = ref('')\r\n\r\n        const feedback = reactive({\r\n            rating: 0,\r\n            comment: ''\r\n        })\r\n\r\n        // 加载咨询详情\r\n        onMounted(async () => {\r\n            try {\r\n                loading.value = true\r\n                error.value = ''\r\n\r\n                const data = await getConsultationById(id)\r\n\r\n                if (data.status !== 'completed') {\r\n                    error.value = '只能对已完成的咨询进行评价'\r\n                    loading.value = false\r\n                    return\r\n                }\r\n\r\n                consultation.value = data\r\n                loading.value = false\r\n            } catch (err) {\r\n                error.value = err.message || '加载咨询详情失败'\r\n                loading.value = false\r\n                console.error('加载咨询详情错误:', err)\r\n            }\r\n        })\r\n\r\n        // 提交评价\r\n        const handleSubmit = async () => {\r\n            try {\r\n                if (!feedback.rating) {\r\n                    submitError.value = '请选择满意度评分'\r\n                    return\r\n                }\r\n\r\n                submitting.value = true\r\n                submitError.value = ''\r\n\r\n                await submitFeedback(id, feedback)\r\n\r\n                // 提交成功后跳转\r\n                router.push({\r\n                    path: '/student/consultations',\r\n                    query: { feedbackSuccess: 'true' }\r\n                })\r\n            } catch (err) {\r\n                submitError.value = err.message || '提交评价失败，请重试'\r\n                submitting.value = false\r\n                console.error('提交评价错误:', err)\r\n            }\r\n        }\r\n\r\n        return {\r\n            consultation,\r\n            loading,\r\n            error,\r\n            submitting,\r\n            submitError,\r\n            feedback,\r\n            handleSubmit\r\n        }\r\n    }\r\n}\r\n</script>"],"mappings":"AA0EA,SAASA,GAAG,EAAEC,QAAQ,EAAEC,SAAQ,QAAS,KAAI;AAC7C,SAASC,QAAQ,EAAEC,SAAQ,QAAS,YAAW;AAC/C,SAASC,mBAAmB,EAAEC,cAAa,QAAS,oCAAmC;AAEvF,eAAe;EACXC,IAAI,EAAE,sBAAsB;EAC5BC,KAAKA,CAAA,EAAG;IACJ,MAAMC,KAAI,GAAIN,QAAQ,CAAC;IACvB,MAAMO,MAAK,GAAIN,SAAS,CAAC;IACzB,MAAM;MAAEO;IAAG,IAAIF,KAAK,CAACG,MAAK;IAE1B,MAAMC,YAAW,GAAIb,GAAG,CAAC,IAAI;IAC7B,MAAMc,OAAM,GAAId,GAAG,CAAC,IAAI;IACxB,MAAMe,KAAI,GAAIf,GAAG,CAAC,EAAE;IACpB,MAAMgB,UAAS,GAAIhB,GAAG,CAAC,KAAK;IAC5B,MAAMiB,WAAU,GAAIjB,GAAG,CAAC,EAAE;IAE1B,MAAMkB,QAAO,GAAIjB,QAAQ,CAAC;MACtBkB,MAAM,EAAE,CAAC;MACTC,OAAO,EAAE;IACb,CAAC;;IAED;IACAlB,SAAS,CAAC,YAAY;MAClB,IAAI;QACAY,OAAO,CAACO,KAAI,GAAI,IAAG;QACnBN,KAAK,CAACM,KAAI,GAAI,EAAC;QAEf,MAAMC,IAAG,GAAI,MAAMjB,mBAAmB,CAACM,EAAE;QAEzC,IAAIW,IAAI,CAACC,MAAK,KAAM,WAAW,EAAE;UAC7BR,KAAK,CAACM,KAAI,GAAI,eAAc;UAC5BP,OAAO,CAACO,KAAI,GAAI,KAAI;UACpB;QACJ;QAEAR,YAAY,CAACQ,KAAI,GAAIC,IAAG;QACxBR,OAAO,CAACO,KAAI,GAAI,KAAI;MACxB,EAAE,OAAOG,GAAG,EAAE;QACVT,KAAK,CAACM,KAAI,GAAIG,GAAG,CAACC,OAAM,IAAK,UAAS;QACtCX,OAAO,CAACO,KAAI,GAAI,KAAI;QACpBK,OAAO,CAACX,KAAK,CAAC,WAAW,EAAES,GAAG;MAClC;IACJ,CAAC;;IAED;IACA,MAAMG,YAAW,GAAI,MAAAA,CAAA,KAAY;MAC7B,IAAI;QACA,IAAI,CAACT,QAAQ,CAACC,MAAM,EAAE;UAClBF,WAAW,CAACI,KAAI,GAAI,UAAS;UAC7B;QACJ;QAEAL,UAAU,CAACK,KAAI,GAAI,IAAG;QACtBJ,WAAW,CAACI,KAAI,GAAI,EAAC;QAErB,MAAMf,cAAc,CAACK,EAAE,EAAEO,QAAQ;;QAEjC;QACAR,MAAM,CAACkB,IAAI,CAAC;UACRC,IAAI,EAAE,wBAAwB;UAC9BC,KAAK,EAAE;YAAEC,eAAe,EAAE;UAAO;QACrC,CAAC;MACL,EAAE,OAAOP,GAAG,EAAE;QACVP,WAAW,CAACI,KAAI,GAAIG,GAAG,CAACC,OAAM,IAAK,YAAW;QAC9CT,UAAU,CAACK,KAAI,GAAI,KAAI;QACvBK,OAAO,CAACX,KAAK,CAAC,SAAS,EAAES,GAAG;MAChC;IACJ;IAEA,OAAO;MACHX,YAAY;MACZC,OAAO;MACPC,KAAK;MACLC,UAAU;MACVC,WAAW;MACXC,QAAQ;MACRS;IACJ;EACJ;AACJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}